<div id="preview">
	<form class="layui-form" action="">
	</form>
</div>
<script type="text/html" id="Editvo">
	{"method":"POST","action":"http://www.s.com","type":"","id":"Form548263631","fields":[{"id":"","rules":"","label":"单行文本","value":"","className":"layui-input","des":"","name":"Name_851346562","rule":"","subtype":"text","defaultType":"空值","defaultValue":"","type":"text","_id":"0"},{"id":"","rules":"","label":"日期时间","value":"","className":"layui-input","des":"","name":"Name_354055804","subtype":"date","defaultType":"空值","defaultValue":"","type":"datetime","_id":"1"},{"id":"","rules":"","label":"单选按钮组","value":"","className":"","des":"","name":"Name_120545838","options":[{"value":"0","label":"选项一"},{"value":"1","label":"选项二"},{"value":"2","label":"选项三"}],"type":"radios","_id":"2"},{"id":"","rules":"","label":"多选按钮组","value":"","className":"","des":"","name":"Name_680356776","skin":"primary","options":[{"value":"0","label":"选项一"},{"value":"1","label":"选项二"},{"value":"2","label":"选项三"}],"type":"checkboxs","_id":"3"},{"id":"","rules":"","label":"下拉框","value":"","className":"","des":"","name":"Name_662590984","options":[{"value":"0","label":"选项一"},{"value":"1","label":"选项二"},{"value":"2","label":"选项三"}],"type":"select","_id":"4"},{"id":"","rules":"","label":"多选下拉框","value":"","className":"","des":"","name":"Name_808395052","options":[{"value":"0","label":"选项一"},{"value":"1","label":"选项二"},{"value":"2","label":"选项三"}],"type":"selects","_id":"5"},{"id":"","rules":"","label":"数字","value":"","className":"layui-input","des":"","name":"Name_58094893","step":"1","min":"1","max":"100","subtype":"number","defaultType":"空值","defaultValue":"","type":"number","_id":"6"},{"id":"","rules":"","label":"","value":"","className":"","des":"","name":"Name_363192164","type":"hr","_id":"7"},{"id":"","rules":"","label":"","value":"按钮","className":"","des":"","name":"Name_159167833","size":"","skin":"primary","subtype":"button","type":"button","_id":"8"},{"id":"","rules":"","label":"多行文本","value":"","className":"layui-textarea","des":"","name":"Name_248207942","defaultType":"空值","defaultValue":"","type":"textarea","_id":"9"}]}
</script>
<script>
	var UUID = function () {
		var d = new Date().getTime();
		var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
			var r = (d + Math.random()*16)%16 | 0;
			d = Math.floor(d/16);
			return (c=='x' ? r : (r&0x3|0x8)).toString(16);
		});
		return uuid;
	}
    function log(){
        console.info.apply(this,arguments);
	}
	layui.use(['jquery','form','laytpl'],function () {
	    var $ = window.$ = layui.jquery,
            form = layui.form,
        	laytpl = layui.laytpl;
        window.Ctrls={
            S : {},
            create:function(opt){
                if(Ctrls[opt.type]){
                    var uuid = UUID();
                    var ctrl= null;
                    if(opt.uuid){
                        var uuid=opt.uuid;
                        ctrl = Ctrls.S[uuid];
                    }else{
                        var ctrl = new Ctrls[opt.type]();
                        ctrl.uuid = uuid;
                        ctrl.type = opt.type;
                        ctrl.attrs = $.extend(true,{id:'',rules:'',label:'',value:'',className:'',des:''},ctrl.attrs);
                        ctrl.attrs.name='Name_'+parseInt(Math.random()*1000000000);
                        for(var i in opt){
                            if(opt[i]){
                                ctrl.attrs[i]=opt[i];
                            }
                        }
                        ctrl.render();
                        Ctrls.S[uuid] = ctrl;
                    }
                    return ctrl.dom;
                }
                return false;
            },
            delete:function(uuid){
                var NS = {};
                for (var i in this.S) {
                    if(i != uuid){
                        NS[i]=this.S[i];
                    }
                }
                this.S = NS;
                $('#ItemList li[uuid="'+uuid+'"]').remove();
            },
            ctrl:function(){
                this.dom='';
                this.tpl='';
                this.uuid='';
                this.set=function(n,v,cb){
                    if(typeof n =='string' && v){
                        this.attrs[n] = v;
                    }else{
                        for(var i in n){
                            this.attrs[i] = n[i];
                        }
                        cb = v;
                    }
                    //log(this);
                    $('#ItemList li[uuid="'+this.uuid+'"]').replaceWith(this.render(true));
                    form.render(null,'ItemList');
                    cb && cb();
                }
                this.get=function(n){
                    return this.attrs[n];
                }
                this.render = function(selected){
                    var opt = $.extend(true, {opthtml:'',uuid:this.uuid}, this.attrs);
                    opt['value'] = opt['value'] ? opt['value'] : '';
                    if(opt['options']){
                        var opthtml = '';
                        for (var i in opt['options']) {
                            opthtml +=laytpl(this.optiontpl).render({name:opt.name,value:opt['value'],skin:opt.skin,option:opt['options'][i],className:opt.className,i:i});
                        }
                        opt['opthtml'] = opthtml;
                    }
                    this.dom = '<li class="item '+(selected && 'selected')+'" uuid="'+this.uuid+'" style="width:100%;">'+laytpl(this.tpl).render(opt)+'</li>';
                    return this.dom;
                }
            },
            ctrls:{
                header : function(){
                    Ctrls.ctrl.call(this);
                    this.subtypes = 'h1,h2,h3,h4,h5,h6';
                    this.tpl = '<div class="layui-form-item" uuid="{{d.uuid}}" style="width:{{d.width}}">'+
                        '	<h1 class="{{d.className}}" id="{{d.id}}">{{d.label}}</h1>'+
                        '</div>';
                    this.attrs = {label:'表头',className:'',id:'',subtypes:'h1'};
                },
                text : function(){
                    Ctrls.ctrl.call(this);
                    this.subtypes = 'text,password';
                    this.defaultTypes = '空值,自定义';
                    this.tpl = '<div class="layui-form-item" uuid="{{d.uuid}}" style="width:{{d.width}}">'+
                        '	<label class="layui-form-label">{{d.label}}</label>'+
                        '	<div class="layui-input-block">'+
                        '		<input type="text" name="{{d.name}}" placeholder="请输入{{d.label}}" autocomplete="off" class="{{d.className}}" value="{{d.value}}">'+
                        '	</div>'+
                        '</div>';
                    this.attrs = {des:'',label:'单行文本',className:'layui-input',id:'',name:'',value:'',rule:'',subtype:'text',defaultType:'空值',defaultValue:""};
                },
                textarea : function(){
                    Ctrls.ctrl.call(this);
                    this.defaultTypes = '空值,自定义';
                    this.tpl = '<div class="layui-form-item" uuid="{{d.uuid}}">'+
                        '	<label class="layui-form-label">{{d.label}}</label>'+
                        '	<div class="layui-input-block">'+
                        '		<textarea name="{{d.name}}" placeholder="请输入{{d.label}}" autocomplete="off" class="layui-textarea">{{d.value}}</textarea>'+
                        '	</div>'+
                        '</div>';
                    this.attrs = {des:'',label:'多行文本',className:'layui-textarea',id:'',name:'',value:'',defaultType:'空值',defaultValue:""};
                },
                datetime : function(){
                    Ctrls.ctrl.call(this);
                    this.defaultTypes = '空值,今天,昨天,自定义';
                    this.subtypes = 'date,time,datetime';
                    this.tpl = '<div class="layui-form-item" uuid="{{d.uuid}}">'+
                        '	<label class="layui-form-label">{{d.label}}</label>'+
                        '	<div class="layui-input-block">'+
                        '		<input type="text" name="{{d.name}}" placeholder="请输入{{d.label}}" autocomplete="off" class="{{d.className}}" value="{{d.value}}">'+
                        '	</div>'+
                        '</div>';
                    this.attrs = {des:'',label:'日期时间',className:'layui-input',id:'',name:'',value:'',subtype:'date',defaultType:'空值',defaultValue:""};
                },
                number : function(){
                    Ctrls.ctrl.call(this);
                    this.subtypes = 'number';
                    this.defaultTypes = '空值,自定义';
                    this.tpl = '<div class="layui-form-item" uuid="{{d.uuid}}">'+
                        '	<label class="layui-form-label">{{d.label}}</label>'+
                        '	<div class="layui-input-block">'+
                        '		<input type="number" name="{{d.name}}" min="{{d.min}}" max="{{d.max}}" step="{{d.step}}" placeholder="请输入{{d.label}}" autocomplete="off" class="{{d.className}}" value="{{d.value}}">'+
                        '	</div>'+
                        '</div>';
                    this.attrs = {des:'',label:'数字',className:'layui-input',id:'',name:'',value:'',step:'1',min:'1',max:'100',subtype:'number',defaultType:'空值',defaultValue:""};
                },
                radios : function(){
                    Ctrls.ctrl.call(this);
                    this.optiontpl = '<input type="radio" name="{{d.name}}" id="{{d.name}}_{{d.i}}" class="{{d.className}}" value="{{d.option.value}}" title="{{d.option.label}}" {{# if(d.option.value == d.value){ }} checked{{# } }}/>';
                    this.tpl = '<div class="layui-form-item" uuid="{{d.uuid}}">'+
                        '	<label class="layui-form-label">{{d.label}}</label>'+
                        '	<div class="layui-input-block">{{d.opthtml}}</div>'+
                        '</div>';
                    this.attrs = {des:'',label:'单选按钮组',className:'',id:'',name:'',value:'',options:[
                            {value:'0',label:'选项一'},
                            {value:'1',label:'选项二'},
                            {value:'2',label:'选项三'}
                        ]};
                },
                checkboxs : function(){
                    Ctrls.ctrl.call(this);
                    this.skins= {'默认风格':'','原始风格':'primary'}
                    this.optiontpl = '<input type="checkbox" name="{{d.name}}" id="{{d.name}}_{{d.i}}" class="{{d.className}}" value="{{d.option.value}}" title="{{d.option.label}}" lay-skin="{{d.skin}}" {{# if(d.value && -1!=$.inArray(d.option.value,d.value.split(","))){ }} checked{{# } }}/>';
                    this.tpl = '<div class="layui-form-item" uuid="{{d.uuid}}">'+
                        '	<label class="layui-form-label">{{d.label}}</label>'+
                        '	<div class="layui-input-block">{{d.opthtml}}</div>'+
                        '</div>';
                    this.attrs = {name:'',des:'',skin:'primary',label:'多选按钮组',className:'',id:'',name:'',value:'',options:[
                            {value:'0',label:'选项一'},
                            {value:'1',label:'选项二'},
                            {value:'2',label:'选项三'}
                        ]};
                },
                select : function(){
                    Ctrls.ctrl.call(this);
                    this.optiontpl = '<option id="{{d.name}}_{{d.i}}" value="{{d.option.value}}" {{# if(d.option.value == d.value){ }} selected{{# } }}>{{d.option.label}}</option>';
                    this.tpl = '<div class="layui-form-item" uuid="{{d.uuid}}">'+
                        '	<label class="layui-form-label">{{d.label}}</label>'+
                        '	<div class="layui-input-block">'+
                        '		<select name="{{d.name}}" name="{{d.id}}" class="{{d.className}}">{{d.opthtml}}</select>'+
                        '	</div>'+
                        '</div>';
                    this.attrs = {des:'',label:'下拉框',className:'',id:'',name:'',value:'',options:[
                            {value:'0',label:'选项一'},
                            {value:'1',label:'选项二'},
                            {value:'2',label:'选项三'}
                        ]};
                },
                selects : function(){
                    Ctrls.ctrl.call(this);
                    this.optiontpl = '<dd><input type="checkbox" value="{{d.option.value}}" title="{{d.option.label}}" lay-skin="primary"> </dd>';
                    this.tpl = '<div class="layui-form-item" uuid="{{d.uuid}}">'+
                        '	<label class="layui-form-label">{{d.label}}</label>'+
                        '	<div class="layui-input-block">'+
                        '		<div class="layui-selects layui-unselect layui-form-select {{d.className}}">'+
                        '			 <div class="layui-select-title">'+
                        '				<input type="hidden" name="{{d.name}}" id="{{d.id}}" value="">'+
                        '				<input type="text" placeholder="请选择" value="" readonly="" class="layui-input layui-unselect">'+
                        '				<i class="layui-edge"></i>'+
                        '			</div>'+
                        '			 <dl class="layui-anim layui-anim-upbit">'+
                        '				 <dd lay-value="" class="layui-select-tips">请选择</dd>{{d.opthtml}}'+
                        '			 </dl>'+
                        '		</div>'+
                        '	</div>'+
                        '</div>';
                    this.attrs = {des:'',label:'多选下拉框',className:'',id:'',name:'',value:'',options:[
                            {value:'0',label:'选项一'},
                            {value:'1',label:'选项二'},
                            {value:'2',label:'选项三'}
                        ]};
                },
                button : function(){
                    Ctrls.ctrl.call(this);
                    this.skins= {'默认':'','大型':'primary','百搭':'normal','暖色':'warm','警告':'danger','禁用':'disabled'};
                    this.subtypes = 'button,submit,reset';
                    this.sizes= {'大型':'lg','默认':'','小型':'sm','迷你':'xs'};
                    this.tpl = '<div class="layui-form-item" uuid="{{d.uuid}}">'+
                        '	<button class="layui-btn'+
                        '{{# if(d.skin!=""){ }} layui-btn-{{d.skin}}{{# } }}'+
                        '{{# if(d.size!=""){ }} layui-btn-{{d.size}}{{# } }}'+
                        '">{{d.value}}</button>'+
                        '</div>';
                    this.attrs = {name:'',id:'',value:'按钮',des:'',size:'',skin:'primary',className:'',subtype:'button'};
                },
                image : function(){
                    Ctrls.ctrl.call(this);
                    this.subtypes = 'image';
                    this.defaultTypes = '空值,自定义';
                    this.tpl = '<div class="layui-form-item" uuid="{{d.uuid}}" style="width:{{d.width}}">'+
                        '	<label class="layui-form-label">{{d.label}}</label>'+
                        '	<div class="layui-input-block">'+
                        '		<input type="file" name="{{d.name}}" placeholder="请输入{{d.label}}" autocomplete="off" class="{{d.className}}" value="{{d.value}}">'+
                        '	</div>'+
                        '</div>';
                    this.attrs = {des:'',label:'图片附件',className:'layui-input',id:'',name:'',value:'',rule:'',subtype:'image',defaultType:'空值',defaultValue:""};
                },
                file : function(){
                    Ctrls.ctrl.call(this);
                    this.subtypes = 'file';
                    this.defaultTypes = '空值,自定义';
                    this.tpl = '<div class="layui-form-item" uuid="{{d.uuid}}" style="width:{{d.width}}">'+
                        '	<label class="layui-form-label">{{d.label}}</label>'+
                        '	<div class="layui-input-block">'+
                        '		<input type="file" name="{{d.name}}" placeholder="请输入{{d.label}}" autocomplete="off" class="{{d.className}}" value="{{d.value}}">'+
                        '	</div>'+
                        '</div>';
                    this.attrs = {des:'',label:'附件',className:'layui-input',id:'',name:'',value:'',rule:'',subtype:'file',defaultType:'空值',defaultValue:""};
                },
                hr : function(){
                    Ctrls.ctrl.call(this);
                    this.tpl = '<div class="layui-form-item" uuid="{{d.uuid}}" style="width:{{d.width}}">'+
                        '	<hr class="{{d.className}}" id="{{d.id}}" />'+
                        '</div>';
                    this.attrs = ['className','id'];
                    this.attrs = {className:'',id:''};
                }
            }
        }
        for(var n in Ctrls.ctrls){
            (function(){
                // 创建一个没有实例方法的类
                var Super = function(){};
                Super.prototype = Ctrls.ctrl.prototype;
                //将实例作为子类的原型
                Ctrls[n] = Ctrls.ctrls[n];
                Ctrls[n].prototype = new Super();
            })();
        }
	    var FormData = $.parseJSON(document.getElementById('Editvo').innerText);
		var html = '<form class="layui-form" method="'+FormData.method+'" type="'+FormData.type+'" action="'+FormData.action+'">';

        for(var i in FormData.fields){
            var field = FormData.fields[i];
            field['_id'] = i;
            html+=Ctrls.create(field);
        }
		html+='</form>';
        $('#preview').append(html);
        form.render();
    });
</script>